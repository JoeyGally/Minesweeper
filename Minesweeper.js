var board = {
  rc0101: null,
  rc0102: null,
  rc0103: null,
  rc0104: null,
  rc0105: null,
  rc0106: null,
  rc0107: null,
  rc0108: null,
  rc0109: null,
  rc0110: null,
  rc0111: null,
  rc0112: null,
  rc0113: null,
  rc0114: null,
  rc0115: null,

  rc0201: null,
  rc0202: null,
  rc0203: null,
  rc0204: null,
  rc0205: null,
  rc0206: null,
  rc0207: null,
  rc0208: null,
  rc0209: null,
  rc0210: null,
  rc0211: null,
  rc0212: null,
  rc0213: null,
  rc0214: null,
  rc0215: null,

  rc0301: null,
  rc0302: null,
  rc0303: null,
  rc0304: null,
  rc0305: null,
  rc0306: null,
  rc0307: null,
  rc0308: null,
  rc0309: null,
  rc0310: null,
  rc0311: null,
  rc0312: null,
  rc0313: null,
  rc0314: null,
  rc0315: null,

  rc0401: null,
  rc0402: null,
  rc0403: null,
  rc0404: null,
  rc0405: null,
  rc0406: null,
  rc0407: null,
  rc0408: null,
  rc0409: null,
  rc0410: null,
  rc0411: null,
  rc0412: null,
  rc0413: null,
  rc0414: null,
  rc0415: null,

  rc0501: null,
  rc0502: null,
  rc0503: null,
  rc0504: null,
  rc0505: null,
  rc0506: null,
  rc0507: null,
  rc0508: null,
  rc0509: null,
  rc0510: null,
  rc0511: null,
  rc0512: null,
  rc0513: null,
  rc0514: null,
  rc0515: null,

  rc0601: null,
  rc0602: null,
  rc0603: null,
  rc0604: null,
  rc0605: null,
  rc0606: null,
  rc0607: null,
  rc0608: null,
  rc0609: null,
  rc0610: null,
  rc0611: null,
  rc0612: null,
  rc0613: null,
  rc0614: null,
  rc0615: null,

  rc0701: null,
  rc0702: null,
  rc0703: null,
  rc0704: null,
  rc0705: null,
  rc0706: null,
  rc0707: null,
  rc0708: null,
  rc0709: null,
  rc0710: null,
  rc0711: null,
  rc0712: null,
  rc0713: null,
  rc0714: null,
  rc0715: null,

  rc0801: null,
  rc0802: null,
  rc0803: null,
  rc0804: null,
  rc0805: null,
  rc0806: null,
  rc0807: null,
  rc0808: null,
  rc0809: null,
  rc0810: null,
  rc0811: null,
  rc0812: null,
  rc0813: null,
  rc0814: null,
  rc0815: null,

  rc0901: null,
  rc0902: null,
  rc0903: null,
  rc0904: null,
  rc0905: null,
  rc0906: null,
  rc0907: null,
  rc0908: null,
  rc0909: null,
  rc0910: null,
  rc0911: null,
  rc0912: null,
  rc0913: null,
  rc0914: null,
  rc0915: null,

  rc1001: null,
  rc1002: null,
  rc1003: null,
  rc1004: null,
  rc1005: null,
  rc1006: null,
  rc1007: null,
  rc1008: null,
  rc1009: null,
  rc1010: null,
  rc1011: null,
  rc1012: null,
  rc1013: null,
  rc1014: null,
  rc1015: null,

  rc1101: null,
  rc1102: null,
  rc1103: null,
  rc1104: null,
  rc1105: null,
  rc1106: null,
  rc1107: null,
  rc1108: null,
  rc1109: null,
  rc1110: null,
  rc1111: null,
  rc1112: null,
  rc1113: null,
  rc1114: null,
  rc1115: null,

  rc1201: null,
  rc1202: null,
  rc1203: null,
  rc1204: null,
  rc1205: null,
  rc1206: null,
  rc1207: null,
  rc1208: null,
  rc1209: null,
  rc1210: null,
  rc1211: null,
  rc1212: null,
  rc1213: null,
  rc1214: null,
  rc1215: null,

  rc1301: null,
  rc1302: null,
  rc1303: null,
  rc1304: null,
  rc1305: null,
  rc1306: null,
  rc1307: null,
  rc1308: null,
  rc1309: null,
  rc1310: null,
  rc1311: null,
  rc1312: null,
  rc1313: null,
  rc1314: null,
  rc1315: null,

  rc1401: null,
  rc1402: null,
  rc1403: null,
  rc1404: null,
  rc1405: null,
  rc1406: null,
  rc1407: null,
  rc1408: null,
  rc1409: null,
  rc1410: null,
  rc1411: null,
  rc1412: null,
  rc1413: null,
  rc1414: null,
  rc1415: null,

  rc1501: null,
  rc1502: null,
  rc1503: null,
  rc1504: null,
  rc1505: null,
  rc1506: null,
  rc1507: null,
  rc1508: null,
  rc1509: null,
  rc1510: null,
  rc1511: null,
  rc1512: null,
  rc1513: null,
  rc1514: null,
  rc1515: null
};
var count = {
  rc0101: null,
  rc0102: null,
  rc0103: null,
  rc0104: null,
  rc0105: null,
  rc0106: null,
  rc0107: null,
  rc0108: null,
  rc0109: null,
  rc0110: null,
  rc0111: null,
  rc0112: null,
  rc0113: null,
  rc0114: null,
  rc0115: null,

  rc0201: null,
  rc0202: null,
  rc0203: null,
  rc0204: null,
  rc0205: null,
  rc0206: null,
  rc0207: null,
  rc0208: null,
  rc0209: null,
  rc0210: null,
  rc0211: null,
  rc0212: null,
  rc0213: null,
  rc0214: null,
  rc0215: null,

  rc0301: null,
  rc0302: null,
  rc0303: null,
  rc0304: null,
  rc0305: null,
  rc0306: null,
  rc0307: null,
  rc0308: null,
  rc0309: null,
  rc0310: null,
  rc0311: null,
  rc0312: null,
  rc0313: null,
  rc0314: null,
  rc0315: null,

  rc0401: null,
  rc0402: null,
  rc0403: null,
  rc0404: null,
  rc0405: null,
  rc0406: null,
  rc0407: null,
  rc0408: null,
  rc0409: null,
  rc0410: null,
  rc0411: null,
  rc0412: null,
  rc0413: null,
  rc0414: null,
  rc0415: null,

  rc0501: null,
  rc0502: null,
  rc0503: null,
  rc0504: null,
  rc0505: null,
  rc0506: null,
  rc0507: null,
  rc0508: null,
  rc0509: null,
  rc0510: null,
  rc0511: null,
  rc0512: null,
  rc0513: null,
  rc0514: null,
  rc0515: null,

  rc0601: null,
  rc0602: null,
  rc0603: null,
  rc0604: null,
  rc0605: null,
  rc0606: null,
  rc0607: null,
  rc0608: null,
  rc0609: null,
  rc0610: null,
  rc0611: null,
  rc0612: null,
  rc0613: null,
  rc0614: null,
  rc0615: null,

  rc0701: null,
  rc0702: null,
  rc0703: null,
  rc0704: null,
  rc0705: null,
  rc0706: null,
  rc0707: null,
  rc0708: null,
  rc0709: null,
  rc0710: null,
  rc0711: null,
  rc0712: null,
  rc0713: null,
  rc0714: null,
  rc0715: null,

  rc0801: null,
  rc0802: null,
  rc0803: null,
  rc0804: null,
  rc0805: null,
  rc0806: null,
  rc0807: null,
  rc0808: null,
  rc0809: null,
  rc0810: null,
  rc0811: null,
  rc0812: null,
  rc0813: null,
  rc0814: null,
  rc0815: null,

  rc0901: null,
  rc0902: null,
  rc0903: null,
  rc0904: null,
  rc0905: null,
  rc0906: null,
  rc0907: null,
  rc0908: null,
  rc0909: null,
  rc0910: null,
  rc0911: null,
  rc0912: null,
  rc0913: null,
  rc0914: null,
  rc0915: null,

  rc1001: null,
  rc1002: null,
  rc1003: null,
  rc1004: null,
  rc1005: null,
  rc1006: null,
  rc1007: null,
  rc1008: null,
  rc1009: null,
  rc1010: null,
  rc1011: null,
  rc1012: null,
  rc1013: null,
  rc1014: null,
  rc1015: null,

  rc1101: null,
  rc1102: null,
  rc1103: null,
  rc1104: null,
  rc1105: null,
  rc1106: null,
  rc1107: null,
  rc1108: null,
  rc1109: null,
  rc1110: null,
  rc1111: null,
  rc1112: null,
  rc1113: null,
  rc1114: null,
  rc1115: null,

  rc1201: null,
  rc1202: null,
  rc1203: null,
  rc1204: null,
  rc1205: null,
  rc1206: null,
  rc1207: null,
  rc1208: null,
  rc1209: null,
  rc1210: null,
  rc1211: null,
  rc1212: null,
  rc1213: null,
  rc1214: null,
  rc1215: null,

  rc1301: null,
  rc1302: null,
  rc1303: null,
  rc1304: null,
  rc1305: null,
  rc1306: null,
  rc1307: null,
  rc1308: null,
  rc1309: null,
  rc1310: null,
  rc1311: null,
  rc1312: null,
  rc1313: null,
  rc1314: null,
  rc1315: null,

  rc1401: null,
  rc1402: null,
  rc1403: null,
  rc1404: null,
  rc1405: null,
  rc1406: null,
  rc1407: null,
  rc1408: null,
  rc1409: null,
  rc1410: null,
  rc1411: null,
  rc1412: null,
  rc1413: null,
  rc1414: null,
  rc1415: null,

  rc1501: null,
  rc1502: null,
  rc1503: null,
  rc1504: null,
  rc1505: null,
  rc1506: null,
  rc1507: null,
  rc1508: null,
  rc1509: null,
  rc1510: null,
  rc1511: null,
  rc1512: null,
  rc1513: null,
  rc1514: null,
  rc1515: null
}
var numMines;

function newGame() {
  numMines = prompt("How many mines?");
  if(numMines == null) {
    return;
  }
  if(numMines < 1) {
    alert("Too few mines!");
    return;
  }
  if(numMines > 224) {
    alert("Too many mines!");
    return;
  }
  for(i=1; i<=15; i++) {
    for(j=1; j<=15; j++) {
      rc = toRC(i, j);
      board[rc] = 0;
      $("#" + rc + " p").css("color", "black");
      $("#" + rc + " p").html("&nbsp;");
    }
  }
  placeMines();
  loadCount();
};
function placeMine() {
  rc = toRC(Math.floor(Math.random() * 15 + 1), Math.floor(Math.random() * 15 + 1));
  if(board[rc] == 0) {
    board[rc] = 1;
    return;
  }
  else {
    placeMine();
  }
}
function placeMines() {
  for(i=1; i<=numMines; i++) {
    placeMine();
  }
};
function displayAll() {
  //For debugging and testing, this displays the locations of mines
  //Please don't cheat :P
  for(i=1; i<=15; i++) {
    for(j=1; j<=15; j++) {
      rc = toRC(i, j);
      if(board[rc] !== null) {
        $("#" + rc + " p").html(String(board["rc" + r + c]));
      }
      if(board[rc] == 0) {
        $("#" + rc + " p").html("&nbsp;");
      }
    }
  }
}
function gameOver() {
  for(i=1; i<=15; i++) {
    for(j=1; j<=15; j++) {
      rc = toRC(i, j);
      if(board[rc] == 1) {
        $("#" + rc + " p").html("X");
      }
      board[rc] = null;
    }
  }
}
function toRC(r, c) {
  return "rc" + ("0" + String(r)).slice(-2) + ("0" + String(c)).slice(-2);
}
function loadCount() {
  for(i=1; i<=15; i++) {
    for(j=1; j<=15; j++) {
      num = 0;
      toSearch = [toRC(i+1, j), toRC(i+1, j+1), toRC(i+1, j-1), toRC(i, j+1), toRC(i, j-1), toRC(i-1, j+1), toRC(i-1, j), toRC(i-1, j-1)];
      for(k=0; k<toSearch.length; k++) {
        if(board[toSearch[k]] == 1) {
          num++;
        }
      }
      count[toRC(i, j)] = num;
    }
  }
}

$("#new").click(function() {
  newGame();
  displayAll();
});

$("div.space").click(function() {
  spot = $(this).attr("id");
  if(board[spot] == null) {
    alert("You need to start a new game!");
    return;
  }
  if(board[spot] == 1) {
    alert("That's a mine! OH NO!!!");
    gameOver();
    $("#" + spot + " p").css("color", "red");
    return;
  }
  if(board[spot] == 0) {
    $("#" + spot + " p").html(String(count[spot]));
    return;
  }
});
